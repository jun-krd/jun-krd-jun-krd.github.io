import{Q as G}from"./QBar.57bcd1b8.js";import{Q as P}from"./QSpace.601fa16e.js";import{Q as L}from"./QToolbar.b2280906.js";import{r as n,k as U,R as w,S as R,n as s,j as Z,ab as Q,p as X,o as K,a6 as E,Z as i,U as g,X as r,$ as h,a8 as ee,a0 as x,a1 as y,Y as W,a2 as te,bu as ae,bE as se,W as oe,a7 as le}from"./index.796e9a09.js";import{Q as re}from"./QPage.976dcdc8.js";import{A as ne}from"./main.esm.a63d2102.js";import{u as ie}from"./use-quasar.737b824d.js";import{api as V}from"./axios.cdca92d4.js";import{l as D}from"./lodash.78b3cd6a.js";import{j as O,n as de}from"./json-util.11434787.js";import{Q as ue}from"./QSelect.a2b6cad7.js";import{u as ce}from"./setYearInfo.de2541ce.js";import"./_commonjsHelpers.b8add541.js";import"./QField.e93cf12f.js";import"./QChip.56e9ec7c.js";import"./QItemSection.ae9ab285.js";import"./QItemLabel.c03d9e19.js";import"./QMenu.c288f19f.js";import"./position-engine.adea6890.js";import"./selection.e36e704c.js";import"./rtl.276c3f1b.js";const me={key:0},pe={key:1},fe={__name:"CompSelectDepg",props:["params"],setup(b){const f=b,d=n(f.params.data),{updateSelectedValue:_}=f.params,C=n(null),m=()=>{_(d)};U(()=>{o()});const o=async()=>{try{const u=await V.post("/api/mst/comm_option_list",{paramCommCd1:"101"});C.value=u.data.data}catch(u){console.error("Error fetching users:",u)}};return(u,l)=>d.value?(w(),R("div",me,[s(ue,{dense:"","options-dense":"",modelValue:d.value.depgCd,"onUpdate:modelValue":[l[0]||(l[0]=c=>d.value.depgCd=c),m],options:C.value,"option-value":"commCd","option-label":"commNm","emit-value":"","map-options":""},null,8,["modelValue","options"])])):(w(),R("div",pe))}},ve={class:"row q-col-gutter-md"},he={class:"col-12"},ge=g("span",{class:"text-subtitle2 q-px-sm"},"\uC18C\uC18D\uD300\uC815\uBCF4\uB9AC\uC2A4\uD2B8",-1),we={class:"q-gutter-xs"},$e={__name:"MstV2020",setup(b){const f=ce(),d=ie(),_=n(500),C=Z(()=>({height:`${_.value}px`})),m=n(null),o=Q({rows:[]}),u=n([]),l=n([]),c=n(!1),S=n(!1);X(()=>{window.removeEventListener("resize",k)}),U(()=>{B.value="multiple",N()}),K(()=>{window.addEventListener("resize",k),k()});const Y=e=>{m.value=e.api},$=Q({def:{flex:1,sortable:!0,filter:!0,floatingFilter:!1,editable:!0}}),A=Q({columns:[{headerName:"",field:"",maxWidth:50,minWidth:50,checkboxSelection:!0,headerCheckboxSelection:!0,filter:!1,pinned:"left"},{headerName:"\uCF54\uB4DC",field:"deptCd",maxWidth:80,minWidth:80,cellEditorParams:{maxLength:5}},{headerName:"\uD56D\uBAA9\uBA85",field:"deptNm",maxWidth:150,minWidth:150},{headerName:"\uC18C\uC18D\uBD84\uB958",field:"depgCd",minWidth:120,maxWidth:120,filter:!0,editable:!1,cellRenderer:fe,cellRendererParams:{updateSelectedValue:e=>{q()}}},{headerName:"\uCC98\uB9AC\uC21C\uC11C",field:"seq",maxWidth:100,minWidth:100,cellEditor:"agNumberCellEditor",cellEditorParams:{precision:2,step:1,showStepperButtons:!0}}]}),v=n(),I=e=>{v.value=e.api.getSelectedRows(),v.value.length===1?(S.value=!0,c.value=!0):v.value.length>1?(S.value=!0,c.value=!1):S.value=!1},q=()=>{l.value=[];for(let e=0;u.value.length>e;e++)JSON.stringify(u.value[e])!==JSON.stringify(o.rows[e])&&o.rows[e].iuD==="U"&&l.value.push(o.rows[e]);l.value.length>0&&(c.value=!0)},B=n(null),M=()=>{c.value=!0,l.value=[];const e=0,a={stdYear:f.setYear,deptCd:"",oldDeptCd:"",deptNm:"",depgNm:"",depgCd:"1011003",seq:o.rows.length+1,iuD:"I"};o.rows.splice(e,0,a),m.value.setRowData(o.rows),m.value.setFocusedCell(e,"deptCd")},j=()=>{d.dialog({dark:!0,title:"\uC790\uB8CC\uC0AD\uC81C",message:"\uC120\uD0DD\uB41C \uC790\uB8CC\uB97C \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C? ",ok:{push:!0,color:"negative"},cancel:{push:!0,color:"grey-7"}}).onOk(()=>{let e=[],a=[];for(let p=0;p<v.value.length;p++){let F='{"mode":"D","data":'+JSON.stringify(v.value[p])+"}";a.push(F)}J(O.jsonFiller(e,a));const t=m.value.getSelectedRows();m.value.applyTransaction({remove:t})}).onCancel(()=>{}).onDismiss(()=>{})},H=()=>{let e=[],a=[];for(let t=0;t<o.rows.length;t++)if(!D.exports.isEmpty(o.rows[t].deptCd)&&o.rows[t].iuD==="I"){let p='{"mode": "'+o.rows[t].iuD+'","data":'+JSON.stringify(o.rows[t])+"}";e.push(p)}for(let t=0;t<l.value.length;t++)if(!D.exports.isEmpty(l.value[t].deptCd)&&l.value[t].iuD==="U"){let p='{"mode": "'+l.value[t].iuD+'","data":'+JSON.stringify(l.value[t])+"}";e.push(p)}console.log("iu ::: ",JSON.stringify(e)),D.exports.isEmpty(e)&&D.exports.isEmpty(a)?d.dialog({dark:!0,title:"\uC548\uB0B4",message:"\uBCC0\uACBD\uB41C \uC790\uB8CC\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4. "}).onOk(()=>{}).onCancel(()=>{}).onDismiss(()=>{}):(J(O.jsonFiller(e,a)),setTimeout(()=>{N()},500))},z=n(0),T=e=>(z.value=e,{minHeight:e?`calc(100vh - ${e}px)`:"100vh"}),k=()=>{_.value=window.innerHeight-z.value-180},N=async()=>{try{const e=await V.post("/api/mst/mst2020_list",{paramSetYear:f.setYear});o.rows=e.data.data,u.value=JSON.parse(JSON.stringify(e.data.data)),l.value=[]}catch(e){console.error("Error fetching users:",e)}},J=e=>{V.post("/api/mst/mst2020_save",e).then(a=>{let t={};a.data.rtn==="0"?(t.rtn=1,t.rtn1=a.data.rtnMsg1,t.rtn2="\uC790\uB8CC\uC800\uC7A5 \uC644\uB8CC"):(t.rtn=a.data.rtn,t.rtn1=a.data.rtnMsg1,t.rtn2=a.data.rtnMsg2),c.value=!1,de.notifyView(t)}).catch(a=>{console.log("error: ",a)})};return(e,a)=>(w(),E(re,{class:"q-pa-xs-xs q-pa-sm-md","style-fn":T},{default:i(()=>[g("div",ve,[g("div",he,[s(le,{bordered:""},{default:i(()=>[s(G,{class:"q-px-sm"},{default:i(()=>[s(r(h),{name:"list_alt"}),ge]),_:1}),s(ee,{align:"right",class:"q-pa-none"},{default:i(()=>[s(L,{class:"row"},{default:i(()=>[s(r(x),{outline:"",color:"positive",dense:"",onClick:N},{default:i(()=>[s(r(h),{name:"refresh",size:"xs",class:"q-mr-sm"}),y("\uB2E4\uC2DC\uBD88\uB7EC\uC624\uAE30")]),_:1}),s(P),g("div",we,[S.value?(w(),E(r(x),{key:0,outline:"",color:"negative",dense:"",onClick:j},{default:i(()=>[s(r(h),{name:"delete",size:"xs"}),y(" \uC0AD\uC81C")]),_:1})):W("",!0),c.value?(w(),E(r(x),{key:1,outline:"",color:"primary",dense:"",onClick:H},{default:i(()=>[s(r(h),{name:"save",size:"xs"}),y(" \uC800\uC7A5 ")]),_:1})):W("",!0),s(r(x),{outline:"",color:"positive",dense:"",onClick:M},{default:i(()=>[s(r(h),{name:"add",size:"xs"}),y(" \uC2E0\uADDC ")]),_:1})])]),_:1})]),_:1}),s(te,{size:"3px"}),s(ae,{class:"q-pa-xs"},{default:i(()=>[g("div",{style:se(C.value)},[s(r(ne),{ref:"myGrid",style:{width:"100%",height:"100%"},class:oe(r(d).dark.isActive?"ag-theme-alpine-dark":"ag-theme-alpine"),columnDefs:A.columns,rowData:o.rows,defaultColDef:$.def,rowSelection:B.value,onSelectionChanged:I,onCellValueChanged:q,onGridReady:Y},null,8,["class","columnDefs","rowData","defaultColDef","rowSelection"])],4)]),_:1})]),_:1})])])]),_:1}))}};export{$e as default};
